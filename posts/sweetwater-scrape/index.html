<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Finding the Perfect Guitar on Sweetwater" /><meta property="og:locale" content="en" /><meta name="description" content="Motivation" /><meta property="og:description" content="Motivation" /><link rel="canonical" href="https://jefflongo.dev/posts/sweetwater-scrape/" /><meta property="og:url" content="https://jefflongo.dev/posts/sweetwater-scrape/" /><meta property="og:site_name" content="Jeff Longo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-15T21:23:00-08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Finding the Perfect Guitar on Sweetwater" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-15T21:23:00-08:00","datePublished":"2023-02-15T21:23:00-08:00","description":"Motivation","headline":"Finding the Perfect Guitar on Sweetwater","mainEntityOfPage":{"@type":"WebPage","@id":"https://jefflongo.dev/posts/sweetwater-scrape/"},"url":"https://jefflongo.dev/posts/sweetwater-scrape/"}</script><title>Finding the Perfect Guitar on Sweetwater | Jeff Longo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jeff Longo"><meta name="application-name" content="Jeff Longo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jeff Longo</a></div><div class="site-subtitle font-italic">Embedded engineer and general nerd. Welcome to my blog.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/jefflongo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jeff.a.longo','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/jeff-longo/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Finding the Perfect Guitar on Sweetwater</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/sweetwater_scrape/stock.png" class="preview-img bg" alt="Sweetwater sample image" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>Finding the Perfect Guitar on Sweetwater</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/jefflongo">Jeff Longo</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1676524980" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-02-15 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1307 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h2 id="motivation"><span class="mr-2">Motivation</span><a href="#motivation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Sweetwater is a great place to shop online for a guitar. One reason for this is that they display <em>real</em> images of guitars they have in stock, and let you choose the one you like best. I was in the market for a Les Paul, but the finish varies (sometimes dramatically) from guitar to guitar due to the burst being done by hand. After internally debating between two different Iced Tea bursts for the better part of an hour, I finally decided to pull the trigger. As I go to the checkout menu, I find, much to my dismay, that the one I had chosen had been sold during my bout of indecisiveness. I didn’t like the finish of the other guitar they had in stock as much, so I decided I’d wait for more stock. Being the impatient person that I am, I knew I would be refreshing the page hourly to try to snatch up a good looking one when it came in stock. That would probably end up driving me crazy. So, naturally, I started looking for an opportunity to automate this task.</p><h2 id="research"><span class="mr-2">Research</span><a href="#research" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The general idea was to create a program that can:</p><ul><li>Fetch in-stock listings from Sweetwater<li>Send a notification when the program detects a listing is new<li>Append an image and a link to the listing in the notification</ul><p>In order to do this, I started looking at the product page for the guitar I was interested in and noticed a few key pieces of identifying information. First, every product has a unique <strong>item ID</strong> listed on the page. Second, each guitar for a given item ID has an associated <strong>serial number</strong>. So the initial plan for the script was to check the webpage with the URL <code class="language-plaintext highlighter-rouge">https://www.sweetwater.com/store/detail/{item id}</code> and try to fetch a list of the serial numbers available on that page. The script would then compare the current listings with the previously seen listings to detect any new serial numbers.</p><p><img data-src="/assets/img/sweetwater_scrape/webpage.png" alt="Sweetwater product page" data-proofer-ignore> <em>Sweetwater product page</em></p><h2 id="scraping-sweetwater"><span class="mr-2">Scraping Sweetwater</span><a href="#scraping-sweetwater" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The typical way to scrape a website is to perform an HTTP get request to fetch the site’s HTML content, parse it, and search it for the identifying information you’re looking for. In this case, I noticed that all the serial numbers are listed in the “Guitar Gallery” header, and the serial number for the currently selected guitar is listed on the left-hand side. So I opened the Chrome developer console and started searching for the serial numbers to see where they are in the HTML source.</p><p><img data-src="/assets/img/sweetwater_scrape/html_source.png" alt="Sweetwater HTML source" data-proofer-ignore> <em>Sweetwater HTML source</em></p><p>Sure enough, the serial numbers are in listed in the <code class="language-plaintext highlighter-rouge">serial-header__photos</code> block. This could be parsed and the serial numbers could be extracted. The trouble is, the Guitar Gallery is only visible when there is more than one guitar in stock. If there is only one guitar in stock, there is no Guitar Gallery. This could be worked around by looking for the Guitar Gallery, and if it’s not there, using the left-hand side current serial number field instead. Ultimately, this was starting to feel ugly, so I decided to try a different approach.</p><p>Another way to scrape a website is by monitoring network traffic on the site and looking for API calls in the HTTP requests. To do this, I opened Chrome’s Network tab in the developer console and refreshed the page. I then searched again for the serial number and found an HTTP request that returned a JSON object with exactly what I needed! The object contained the current available serial numbers, the URL’s of their images, the product name, and tons of other useful information.</p><p><img data-src="/assets/img/sweetwater_scrape/api_call.png" alt="Sweetwater API call" data-proofer-ignore> <em>Sweetwater API call</em></p><p>The plan became a lot more simple. All that was needed was to make an HTTP request to the API, and parse the resulting JSON object.</p><h2 id="writing-the-script"><span class="mr-2">Writing the Script</span><a href="#writing-the-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Python was my language of choice because it’s trivial to make HTTP requests and work with JSON. I started by testing out the HTTP request:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>

<span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LPS6ITNH</span>
<span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"https://www.sweetwater.com/webservices_sw/items/detail/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s">?format=serialcompare"</span>
<span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># otherwise we get a 403 error
</span>    <span class="s">"User-Agent"</span><span class="p">:</span> <span class="s">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36"</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">IOError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"ERROR: failed to fetch products (</span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">)"</span>
    <span class="p">)</span> <span class="k">from</span> <span class="n">e</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
<span class="k">except</span> <span class="n">json</span><span class="p">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">IOError</span><span class="p">(</span><span class="s">"ERROR: Failed to parse product JSON"</span><span class="p">)</span> <span class="k">from</span> <span class="n">e</span>
</pre></table></code></div></div><p>Initially, the request would return a <code class="language-plaintext highlighter-rouge">403 Forbidden</code> error. This was solved by populating the <code class="language-plaintext highlighter-rouge">User-Agent</code> field of the HTTP header, which provides some identifying information about the browser and the host OS to the web server. Some websites will block HTTP requests without this field to prevent non-browsers such as web scrapers from making requests.</p><p>After this was working, I unpacked the JSON results into a Python object. I store the resulting objects in a <code class="language-plaintext highlighter-rouge">set</code>, which has the nice property of ignoring duplicate entries and supporting a set-difference operation to find objects belonging to one set but not another.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">SweetwaterProduct</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">serial</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">images</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">serial</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">serial</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">images</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">images</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SweetwaterProduct</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">serial</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">serial</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">serial</span><span class="p">)</span>

<span class="n">products</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> 
<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"productName"</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="nb">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">SweetwaterProduct</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">serial</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">"serialNumber"</span><span class="p">][</span><span class="s">"number"</span><span class="p">]),</span>
                <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s">'https://www.sweetwater.com</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s">"serialUrl"</span><span class="p">]</span><span class="si">}</span><span class="s">'</span><span class="p">,</span>
                <span class="n">images</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">item</span><span class="p">[</span><span class="s">"images"</span><span class="p">][</span><span class="n">view</span><span class="p">][</span><span class="s">"images"</span><span class="p">][</span><span class="s">"750"</span><span class="p">][</span><span class="s">"absolutePath"</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"angle"</span><span class="p">]</span>  <span class="c1"># can also use body, front, back
</span>                <span class="p">],</span>
            <span class="p">),</span>
            <span class="n">data</span><span class="p">[</span><span class="s">"comparableSerials"</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="nb">KeyError</span><span class="p">,</span> <span class="nb">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">IOError</span><span class="p">(</span><span class="s">"ERROR: Invalid key access when parsing product JSON"</span><span class="p">)</span> <span class="k">from</span> <span class="n">e</span>

<span class="n">products</span> <span class="o">|=</span> <span class="n">items</span>
</pre></table></code></div></div><p>With this code in place, finding new products is as simple as <code class="language-plaintext highlighter-rouge">new_product = products - seen_products</code>. And as a bonus, sold products can also by computed by <code class="language-plaintext highlighter-rouge">sold_products = seen_products - products</code>.</p><p>To handle notifications, I decided to use a <a href="https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks">Discord Webhook</a>. This enables posting content to a specific channel in a specific server by performing an HTTP post to a URL, which was enough for my needs.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">post_discord</span><span class="p">(</span><span class="n">webhook</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">roles</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"@</span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s"> "</span>
    <span class="n">content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"</span><span class="se">\n\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s">"</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">"content"</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span> <span class="s">"username"</span><span class="p">:</span> <span class="s">"SweetwaterBot"</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">webhook</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">IOError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s">"ERROR: failed to post to discord (</span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">)"</span>
        <span class="p">)</span> <span class="k">from</span> <span class="n">e</span>
</pre></table></code></div></div><h2 id="results"><span class="mr-2">Results</span><a href="#results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Ultimately, I left the script running on a Raspberry Pi checking Sweetwater every 5 minutes. The discord integration provides a link and an image of new listings, notifications when listings are sold, and supports watching multiple different item IDs simultaneously.</p><p><img data-src="/assets/img/sweetwater_scrape/discord.png" alt="Discord notifications" data-proofer-ignore> <em>The Discord notifications</em></p><p>If I were to continue developing this project, I would replace the Discord webhook with a full-fledged Discord bot, and allow the watchlist to be editable by interacting with the bot instead of hard-coding the watchlist. In the future I’d like to explore making a general purpose Discord bot with support for plugins that could be added in, like this one.</p><p>After spending about 6 hours writing this script, I ended up purchasing a guitar only one day later. So was the script necessary? Probably not. But it was a lot of fun to write and taught me something new about web scraping. Plus, I’m very happy with the guitar I ended up with.</p><p><img data-src="/assets/img/sweetwater_scrape/guitar.jpg" alt="My Les Paul" data-proofer-ignore> <em>My Gibson Les Paul Standard 60’s Iced Tea</em></p><p>Feel free to check out the code <a href="https://github.com/jefflongo/sweetwater-scrape">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/projects/'>Projects</a>, <a href='/categories/software/'>Software</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/guitar/" class="post-tag no-text-decoration" >guitar</a> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/web-scraping/" class="post-tag no-text-decoration" >web-scraping</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Finding the Perfect Guitar on Sweetwater - Jeff Longo&amp;url=https://jefflongo.dev/posts/sweetwater-scrape/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Finding the Perfect Guitar on Sweetwater - Jeff Longo&amp;u=https://jefflongo.dev/posts/sweetwater-scrape/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://jefflongo.dev/posts/sweetwater-scrape/&amp;text=Finding the Perfect Guitar on Sweetwater - Jeff Longo" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gc-controller-reverse-engineering-part-1/">GameCube Controller Reverse Engineering (Part 1)</a><li><a href="/posts/gc-adapter-reverse-engineering/">GameCube Adapter Reverse Engineering</a><li><a href="/posts/2018-portable-wii/">From Knowing Nothing to Building a Portable Wii</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/gamecube/">gamecube</a> <a class="post-tag" href="/tags/wii/">wii</a> <a class="post-tag" href="/tags/3d-printing/">3d-printing</a> <a class="post-tag" href="/tags/guitar/">guitar</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/keyboards/">keyboards</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/web-scraping/">web-scraping</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/2018-portable-wii/"><div class="card-body"> <em class="timeago small" data-ts="1647794940" > 2022-03-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>From Knowing Nothing to Building a Portable Wii</h3><div class="text-muted small"><p> The Beginning I somehow stumbled across this video of a portable GameCube. I was instantly obsessed and knew I had to make one too. At this point in time, I had recently graduated high school, and...</p></div></div></a></div><div class="card"> <a href="/posts/wii-micro/"><div class="card-body"> <em class="timeago small" data-ts="1662183900" > 2022-09-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building the Perfect Travel Wii</h3><div class="text-muted small"><p> Why Bother? As a competitive Super Smash Bros. Melee player, I always have a Wii and CRT TV on hand to boot up a game of Melee. I’ve traveled to many different venues, and try to bring a setup whe...</p></div></div></a></div><div class="card"> <a href="/posts/2021-wii-portable/"><div class="card-body"> <em class="timeago small" data-ts="1662244800" > 2022-09-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Portable Wii Endgame</h3><div class="text-muted small"><p> Back at it Again One of the limitations of creating a portable Wii has always been ergonomics. Creating an organic design that feels good in the hands is an extremely non-trivial task. Wouldn’t it...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/gc-adapter-reverse-engineering/" class="btn btn-outline-primary" prompt="Older"><p>GameCube Adapter Reverse Engineering</p></a> <a href="/posts/dvorak-6-month/" class="btn btn-outline-primary" prompt="Newer"><p>Dvorak 6 Month Reflection</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "jefflongo/blog-comments", "data-repo-id": "R_kgDOHCLY9g", "data-category": "Announcements", "data-category-id": "DIC_kwDOHCLY9s4COMIn", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/jefflongo">Jeff Longo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/gamecube/">gamecube</a> <a class="post-tag" href="/tags/wii/">wii</a> <a class="post-tag" href="/tags/3d-printing/">3d-printing</a> <a class="post-tag" href="/tags/guitar/">guitar</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/keyboards/">keyboards</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/web-scraping/">web-scraping</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-8D5SLD81DC"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-8D5SLD81DC'); }); </script>
